## Project Overview

PyEMD is a Python/Cython wrapper for the Earth Mover's Distance algorithm (Pele & Werman's C++ implementation). Exposes three functions: `emd()`, `emd_with_flow()`, `emd_samples()`.

## Code Structure

```
src/pyemd/
├── __init__.py      # Python API, exports emd, emd_with_flow, emd_samples
├── emd.pyx          # Cython wrapper (compiles to C++)
├── _version.py      # Auto-generated by setuptools_scm
└── lib/             # C++ header-only library (upstream, don't modify)
    └── emd_hat.hpp  # Main EMD algorithm
test/
└── test_pyemd.py    # pytest tests
```

## Build System

Uses **meson-python** (build backend) + **uv** (package manager). Config in `pyproject.toml` and `meson.build`.

## Commands

```bash
# Setup
uv sync --all-extras

# Build and install (required after code changes)
make develop

# Run tests
make test
# or: uv run pytest

# Clean build artifacts
make clean

# Build wheel only
uv build --wheel
```

**IMPORTANT:** This project uses wheel-based development (not editable installs). Editable installs (`uv pip install -e .`) will fail with stale build path errors like:
```
FileNotFoundError: .../builds-v0/.tmpXXXXXX/bin/ninja
```
Always use `make develop` or `uv pip install .` (non-editable) instead.

## Testing

Tests in `test/test_pyemd.py`. Run with `make test` or `uv run pytest`.

Test patterns:
- `emd_assert(got, expected)` - compare EMD values (5 decimal precision)
- `emd_flow_assert(got, expected)` - compare EMD + flow matrix
- Use `pytest.raises(ValueError)` for validation tests

## Changelog Fragments (MANDATORY)

**Create a towncrier fragment for every change** in `changelog.d/`:

```bash
# With issue number
echo "Description" > changelog.d/<issue-number>.<type>

# Without issue (+ prefix)
echo "Description" > changelog.d/+<short-name>.<type>
```

**Types:** `.feature`, `.bugfix`, `.doc`, `.removal`, `.misc`

**Guidelines:** One fragment per change, user perspective, past tense ("Added...", "Fixed...")

Preview: `uv run towncrier build --draft --version 0.0.0`

## Versioning

Git-based via setuptools_scm. Version derived from tags (e.g., `v0.5.2`).

## Key Dependencies

- Build: meson-python, cython>=3.0, numpy>=2.0
- Runtime: numpy>=1.9.0
- Test: pytest
